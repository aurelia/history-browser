{"version":3,"file":"aurelia-history-browser.js","sources":["../../src/link-handler.ts","../../src/browser-history.ts","../../src/aurelia-history-browser.ts"],"sourcesContent":["import { DOM, PLATFORM } from 'aurelia-pal';\nimport { BrowserHistory } from './browser-history';\nimport { AnchorEventInfo } from './interfaces';\n\n/**\n * Class responsible for handling interactions that should trigger browser history navigations.\n */\nexport class LinkHandler {\n  /**\n   * Activate the instance.\n   *\n   * @param history The BrowserHistory instance that navigations should be dispatched to.\n   */\n  activate(history: BrowserHistory): void {/**/}\n\n  /**\n   * Deactivate the instance. Event handlers and other resources should be cleaned up here.\n   */\n  deactivate(): void {/**/}\n}\n\n/**\n * The default LinkHandler implementation. Navigations are triggered by click events on\n * anchor elements with relative hrefs when the history instance is using pushstate.\n */\nexport class DefaultLinkHandler extends LinkHandler {\n\n  /**@internal */\n  handler: (e: Event) => void;\n\n  /**@internal */\n  history: BrowserHistory;\n  /**\n   * Creates an instance of DefaultLinkHandler.\n   */\n  constructor() {\n    super();\n\n    this.handler = (e) => {\n      let { shouldHandleEvent, href } = DefaultLinkHandler.getEventInfo(e);\n\n      if (shouldHandleEvent) {\n        e.preventDefault();\n        this.history.navigate(href);\n      }\n    };\n  }\n\n  /**\n   * Activate the instance.\n   *\n   * @param history The BrowserHistory instance that navigations should be dispatched to.\n   */\n  activate(history: BrowserHistory): void {\n    if (history._hasPushState) {\n      this.history = history;\n      DOM.addEventListener('click', this.handler, true);\n    }\n  }\n\n  /**\n   * Deactivate the instance. Event handlers and other resources should be cleaned up here.\n   */\n  deactivate(): void {\n    DOM.removeEventListener('click', this.handler, true);\n  }\n\n  /**\n   * Gets the href and a \"should handle\" recommendation, given an Event.\n   *\n   * @param event The Event to inspect for target anchor and href.\n   */\n  static getEventInfo(event: Event): AnchorEventInfo {\n    let $event = event as MouseEvent;\n    let info = {\n      shouldHandleEvent: false,\n      href: null,\n      anchor: null\n    };\n\n    let target = DefaultLinkHandler.findClosestAnchor($event.target as Element);\n    if (!target || !DefaultLinkHandler.targetIsThisWindow(target)) {\n      return info;\n    }\n\n    if (hasAttribute(target, 'download')\n      || hasAttribute(target, 'router-ignore')\n      || hasAttribute(target, 'data-router-ignore')\n    ) {\n      return info;\n    }\n\n    if ($event.altKey || $event.ctrlKey || $event.metaKey || $event.shiftKey) {\n      return info;\n    }\n\n    let href = target.getAttribute('href');\n    info.anchor = target;\n    info.href = href;\n\n    let leftButtonClicked = $event.which === 1;\n    let isRelative = href && !(href.charAt(0) === '#' || (/^[a-z]+:/i).test(href));\n\n    info.shouldHandleEvent = leftButtonClicked && isRelative;\n    return info;\n  }\n\n  /**\n   * Finds the closest ancestor that's an anchor element.\n   *\n   * @param el The element to search upward from.\n   * @returns The link element that is the closest ancestor.\n   */\n  static findClosestAnchor(el: Element): Element {\n    while (el) {\n      if (el.tagName === 'A') {\n        return el;\n      }\n\n      el = el.parentNode as Element;\n    }\n  }\n\n  /**\n   * Gets a value indicating whether or not an anchor targets the current window.\n   *\n   * @param target The anchor element whose target should be inspected.\n   * @returns True if the target of the link element is this window; false otherwise.\n   */\n  static targetIsThisWindow(target: Element): boolean {\n    let targetWindow = target.getAttribute('target');\n    let win = PLATFORM.global;\n\n    return !targetWindow ||\n      targetWindow === win.name ||\n      targetWindow === '_self';\n  }\n}\n\nconst hasAttribute = (el: Element, attr: string) => el.hasAttribute(attr);\n","import { DOM, PLATFORM } from 'aurelia-pal';\nimport { LinkHandler } from './link-handler';\nimport { History } from 'aurelia-history';\n\n/**\n * An implementation of the basic history API.\n */\nexport class BrowserHistory extends History {\n  /**@internal */\n  static inject = [LinkHandler];\n\n  /**@internal */\n  _isActive: boolean;\n\n  /**@internal*/\n  _checkUrlCallback: any;\n  /**@internal*/\n  location: Location;\n  /**@internal*/\n  history: typeof PLATFORM['history'];\n  /**@internal*/\n  linkHandler: LinkHandler;\n  /**@internal*/\n  options: any;\n  /**@internal*/\n  root: string;\n  /**@internal*/\n  _wantsHashChange: boolean;\n  /**@internal*/\n  _hasPushState: boolean;\n  /**@internal*/\n  fragment: string;\n\n  /**\n   * Creates an instance of BrowserHistory\n   * @param linkHandler An instance of LinkHandler.\n   */\n  constructor(linkHandler: LinkHandler) {\n    super();\n\n    this._isActive = false;\n    this._checkUrlCallback = this._checkUrl.bind(this);\n\n    this.location = PLATFORM.location;\n    this.history = PLATFORM.history;\n    this.linkHandler = linkHandler;\n  }\n\n  /**\n   * Activates the history object.\n   * @param options The set of options to activate history with.\n   * @returns Whether or not activation occurred.\n   */\n  activate(options?: Object): boolean {\n    if (this._isActive) {\n      throw new Error('History has already been activated.');\n    }\n\n    let $history = this.history;\n    let wantsPushState = !!(options as any).pushState;\n\n    this._isActive = true;\n    let normalizedOptions = this.options = Object.assign({}, { root: '/' }, this.options, options);\n\n    // Normalize root to always include a leading and trailing slash.\n    let rootUrl = this.root = ('/' + normalizedOptions.root + '/').replace(rootStripper, '/');\n\n    let wantsHashChange = this._wantsHashChange = normalizedOptions.hashChange !== false;\n    let hasPushState = this._hasPushState = !!(normalizedOptions.pushState && $history && $history.pushState);\n\n    // Determine how we check the URL state.\n    let eventName: string;\n    if (hasPushState) {\n      eventName = 'popstate';\n    } else if (wantsHashChange) {\n      eventName = 'hashchange';\n    }\n\n    PLATFORM.addEventListener(eventName, this._checkUrlCallback);\n\n    // Determine if we need to change the base url, for a pushState link\n    // opened by a non-pushState browser.\n    if (wantsHashChange && wantsPushState) {\n      // Transition from hashChange to pushState or vice versa if both are requested.\n      let $location = this.location;\n      let atRoot = $location.pathname.replace(/[^\\/]$/, '$&/') === rootUrl;\n\n      // If we've started off with a route from a `pushState`-enabled\n      // browser, but we're currently in a browser that doesn't support it...\n      if (!hasPushState && !atRoot) {\n        let fragment =  this.fragment = this._getFragment(null, true);\n        $location.replace(rootUrl + $location.search + '#' + fragment);\n        // Return immediately as browser will do redirect to new url\n        return true;\n\n        // Or if we've started out with a hash-based route, but we're currently\n        // in a browser where it could be `pushState`-based instead...\n      } else if (hasPushState && atRoot && $location.hash) {\n        let fragment = this.fragment = this._getHash().replace(routeStripper, '');\n        $history.replaceState({}, DOM.title, rootUrl + fragment + $location.search);\n      }\n    }\n\n    if (!this.fragment) {\n      this.fragment = this._getFragment('');\n    }\n\n    this.linkHandler.activate(this);\n\n    if (!normalizedOptions.silent) {\n      return this._loadUrl('');\n    }\n  }\n\n  /**\n   * Deactivates the history object.\n   */\n  deactivate(): void {\n    const handler = this._checkUrlCallback;\n    PLATFORM.removeEventListener('popstate', handler);\n    PLATFORM.removeEventListener('hashchange', handler);\n    this._isActive = false;\n    this.linkHandler.deactivate();\n  }\n\n  /**\n   * Returns the fully-qualified root of the current history object.\n   * @returns The absolute root of the application.\n   */\n  getAbsoluteRoot(): string {\n    let $location = this.location;\n    let origin = createOrigin($location.protocol, $location.hostname, $location.port);\n    return `${origin}${this.root}`;\n  }\n\n  /**\n   * Causes a history navigation to occur.\n   *\n   * @param fragment The history fragment to navigate to.\n   * @param options The set of options that specify how the navigation should occur.\n   * @return Promise if triggering navigation, otherwise true/false indicating if navigation occurred.\n   */\n  navigate(fragment?: string, {trigger = true, replace = false} = {}): boolean {\n    let location = this.location;\n    if (fragment && absoluteUrl.test(fragment)) {\n      location.href = fragment;\n      return true;\n    }\n\n    if (!this._isActive) {\n      return false;\n    }\n\n    fragment = this._getFragment(fragment || '');\n\n    if (this.fragment === fragment && !replace) {\n      return false;\n    }\n\n    this.fragment = fragment;\n\n    let url = this.root + fragment;\n\n    // Don't include a trailing slash on the root.\n    if (fragment === '' && url !== '/') {\n      url = url.slice(0, -1);\n    }\n\n    // If pushState is available, we use it to set the fragment as a real URL.\n    if (this._hasPushState) {\n      url = url.replace('//', '/');\n      this.history[replace ? 'replaceState' : 'pushState']({}, DOM.title, url);\n    } else if (this._wantsHashChange) {\n      // If hash changes haven't been explicitly disabled, update the hash\n      // fragment to store history.\n      updateHash(location, fragment, replace);\n    } else {\n      // If you've told us that you explicitly don't want fallback hashchange-\n      // based history, then `navigate` becomes a page refresh.\n      location.assign(url);\n    }\n\n    if (trigger) {\n      return this._loadUrl(fragment);\n    }\n\n    return true;\n  }\n\n  /**\n   * Causes the history state to navigate back.\n   */\n  navigateBack(): void {\n    this.history.back();\n  }\n\n  /**\n   * Sets the document title.\n   */\n  setTitle(title: string): void {\n    DOM.title = title;\n  }\n\n  /**\n   * Sets a key in the history page state.\n   * @param key The key for the value.\n   * @param value The value to set.\n   */\n  setState(key: string, value: any): void {\n    let $history = this.history;\n    let state = Object.assign({}, $history.state);\n    let { pathname, search, hash } = this.location;\n    state[key] = value;\n    $history.replaceState(state, null, `${pathname}${search}${hash}`);\n  }\n\n  /**\n   * Gets a key in the history page state.\n   * @param key The key for the value.\n   * @return The value for the key.\n   */\n  getState(key: string): any {\n    let state = Object.assign({}, this.history.state);\n    return state[key];\n  }\n\n  /**\n   * Returns the current index in the navigation history.\n   * @returns The current index.\n   */\n  getHistoryIndex(): number {\n    let historyIndex = this.getState('HistoryIndex');\n    if (historyIndex === undefined) {\n      historyIndex = this.history.length - 1;\n      this.setState('HistoryIndex', historyIndex);\n    }\n    return historyIndex;\n  }\n\n  /**\n   * Move to a specific position in the navigation history.\n   * @param movement The amount of steps, positive or negative, to move.\n   */\n  go(movement: number): void {\n    this.history.go(movement);\n  }\n\n  /**\n   * @internal\n   */\n  _getHash(): string {\n    return this.location.hash.substr(1);\n  }\n\n  /**\n   * @internal\n   */\n  _getFragment(fragment: string, forcePushState?: boolean): string {\n    let rootUrl: string;\n\n    if (!fragment) {\n      if (this._hasPushState || !this._wantsHashChange || forcePushState) {\n        let location = this.location;\n        fragment = location.pathname + location.search;\n        rootUrl = this.root.replace(trailingSlash, '');\n        if (!fragment.indexOf(rootUrl)) {\n          fragment = fragment.substr(rootUrl.length);\n        }\n      } else {\n        fragment = this._getHash();\n      }\n    }\n\n    return '/' + fragment.replace(routeStripper, '');\n  }\n\n  /**\n   * Url change handler.\n   * Invoked when current fragment is different with previous fragment\n   * @internal\n   */\n  _checkUrl(): void {\n    let current = this._getFragment('');\n    if (current !== this.fragment) {\n      this._loadUrl('');\n    }\n  }\n\n  /**\n   * invoke routeHandler\n   * @internal\n   */\n  _loadUrl(fragmentOverride: string): boolean {\n    let fragment = this.fragment = this._getFragment(fragmentOverride);\n\n    return this.options.routeHandler ?\n      this.options.routeHandler(fragment) :\n      false;\n  }\n}\n\n// Cached regex for stripping a leading hash/slash and trailing space.\nconst routeStripper = /^#?\\/*|\\s+$/g;\n\n// Cached regex for stripping leading and trailing slashes.\nconst rootStripper = /^\\/+|\\/+$/g;\n\n// Cached regex for removing a trailing slash.\nconst trailingSlash = /\\/$/;\n\n// Cached regex for detecting if a URL is absolute,\n// i.e., starts with a scheme or is scheme-relative.\n// See http://www.ietf.org/rfc/rfc2396.txt section 3.1 for valid scheme format\nconst absoluteUrl = /^([a-z][a-z0-9+\\-.]*:)?\\/\\//i;\n\n// Update the hash location, either replacing the current entry, or adding\n// a new one to the browser history.\nfunction updateHash($location: Location, fragment: string, replace: boolean) {\n  if (replace) {\n    let href = $location.href.replace(/(javascript:|#).*$/, '');\n    $location.replace(href + '#' + fragment);\n  } else {\n    // Some browsers require that `hash` contains a leading #.\n    $location.hash = '#' + fragment;\n  }\n}\n\nfunction createOrigin(protocol: string, hostname: string, port: string) {\n  return `${protocol}//${hostname}${port ? ':' + port : ''}`;\n}\n","import {History} from 'aurelia-history';\nimport {LinkHandler, DefaultLinkHandler} from './link-handler';\nimport { BrowserHistory } from './browser-history';\n\n/**\n * Configures the plugin by registering BrowserHistory as the implementation of History in the DI container.\n * @param config The FrameworkConfiguration object provided by Aurelia.\n */\nexport function configure(config: Object): void {\n  // work around for converting to TS without breaking compat\n  const $config = config as any;\n  $config.singleton(History, BrowserHistory);\n  $config.transient(LinkHandler, DefaultLinkHandler);\n}\n\nexport {\n  LinkHandler,\n  DefaultLinkHandler,\n  BrowserHistory\n};\n"],"names":["tslib_1.__extends"],"mappings":"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"}